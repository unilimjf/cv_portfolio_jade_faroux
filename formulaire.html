<!DOCTYPE html>
<html lang="fr-FR">

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="feuille_de_style.css">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <title>Formulaire de commande en ligne - Tyrian Takeout</title>
</head>

<body>
  <h1>Plats à emporter</h1><img class="logo" src="logo_cercle.png" alt="Logo Tyrian Takeout">
  <h2>COMMANDEZ EN LIGNE !</h2>
  <div>
    <form id="formulaire_commande"> <!-- à voir où envoyer le formulaire : action="mailto:..."-->
      <fieldset id="partie1">
        <legend>Informations personnelles</legend><br>
        <div class="nom-p">
          <p>
            <label for="prenom">Prénom : </label>
            <input type="text" name="prenom" id="prenom" placeholder=" Praise">
          </p>
          <p>
            <label for="nom">Nom : </label>
            <input type="text" name="nom" id="nom" placeholder=" Joko">
          </p>
        </div>
        <p>
          <label for="mail">E-mail : </label>
          <input type="text" name="mail" id="mail" placeholder=" votre.adresse@mail.fr">
        </p>
        <p>
          <label for="tel">Numéro de téléphone : </label>
          <input type="text" name="tel" id="tel" placeholder=" 01 23 45 67 89">
        </p>
      </fieldset>
      <fieldset id="partie2">
        <legend>Livraison</legend>

        <div class="emporter">
          <p>Voulez-vous récupérer votre commande?</p>
          <input type="radio" id="pickup" name="order_option" value="pickup">
          <label for="pickup">Oui.</label>

          <input type="radio" id="delivery" name="order_option" value="delivery">
          <label>Non, je demande une livraison.</label>

          <p>Date et heure de récupération</p>
          <div class="date-heure">
            <div>
              <label for="date_pickup">Date</label><br>
              <input type="date" id="date_pickup" name="pickup_date">
            </div>
            <div>
              <label for="time">Heure Minutes</label><br>
              <select id="time" name="pickup_time">
                <option value="" selected disabled>- - : - -</option>
                <option value="08:00">08:00</option>
                <option value="08:30">08:30</option>
                <option value="09:00">09:00</option>
                <option value="09:30">09:30</option>
                <option value="10:00">10:00</option>
                <option value="10:30">10:30</option>
                <option value="11:00">11:00</option>
                <option value="11:30">11:30</option>
                <option value="12:00">12:00</option>
                <option value="14:00">14:00</option>
                <option value="14:30">14:30</option>
                <option value="15:00">15:00</option>
                <option value="15:30">15:30</option>
                <option value="16:00">16:00</option>
                <option value="16:30">16:30</option>
                <option value="17:00">17:00</option>
                <option value="17:30">17:30</option>
                <option value="18:00">18:00</option>
                <!-- Ajoute toutes les valeurs nécessaires -->
              </select>
            </div>
          </div>
        </div>
        <div class="partie2">
          <p>
            <label for="adresse_livraison">Adresse de livraison : </label>
            <textarea cols="30" rows="3" name="adresse_livraison" id="adresse_livraison"
              placeholder=" 12 rue du Hall de Durmand"></textarea>
          </p>
          <p>
            <label for="ville_livraison">Ville : </label>
            <input type="text" name="ville_livraison" id="ville_livraison" placeholder=" Promontoire Divin">
          </p>
          <p>
            <label for="code_postal_livraison">Code postal : </label>
            <input type="text" name="code_postal_livraison" id="code_postal_livraison" placeholder=" 10000">
          </p>
        </div>
      </fieldset>
      <br>
      <fieldset id="partie3">
        <legend>Produits</legend>
        <div class="container">

          <!-- Section Plats Populaires -->
          <h2>Tous nos produits</h2>
          <div class="menu-items">
            <div class="menu-item">
              <img src="braises.png" alt="braises charcuterie">
              <h3>Légion Braises</h3>
              <p>Assiette de charcuteries locale</p>
              <h4>15.00€</h4>
              <div class="quantite-container">
                <button type="button" class="moins">-</button>
                <input class="quantite" type="number" id="quantite1" name="quantite" min="0" max="10" value="0"
                  step="1">
                <button type="button" class="plus">+</button>
              </div>
            </div>

            <div class="menu-item">
              <span class="discount">15% OFF</span>
              <img src="moaburger.png" alt="moa Burger">
              <h3>Moa Smash</h3>
              <p>Burger à la viande de Moa</p>
              <h4>12.90€</h4>
              <div class="quantite-container">
                <button type="button" class="moins">-</button>
                <input class="quantite" type="number" id="quantite2" name="quantite" min="0" max="10" value="0"
                  step="1">
                <button type="button" class="plus">+</button>
              </div>
            </div>

            <div class="menu-item">
              <img src="ragout.png" alt="Ragout Norn">
              <h3>Ragoût Norn</h3>
              <p>Viande mijotée et légumes rôtis</p>
              <h4>12.99€</h4>
              <div class="quantite-container">
                <button type="button" class="moins">-</button>
                <input class="quantite" type="number" id="quantite3" name="quantite" min="0" max="10" value="0"
                  step="1">
                <button type="button" class="plus">+</button>
              </div>
            </div>

            <div class="menu-item">
              <span class="discount">15% OFF</span>
              <img src="grog-dragon.png" alt="Grog du Dragon">
              <h3>Grog du Dragon</h3>
              <p>Cocktail à base de rhum épicé</p>
              <h4>6.99€</h4>
              <div class="quantite-container">
                <button type="button" class="moins">-</button>
                <input class="quantite" type="number" id="quantite4" name="quantite" min="0" max="10" value="0"
                  step="1">
                <button type="button" class="plus">+</button>
              </div>
            </div>
            <div class="menu-item">
              <img src="potion-ether.png" alt="Potion d'Éther">
              <h3>Potion d'Éther</h3>
              <p>Soda gazeux bleu mystique</p>
              <h4>8.99€</h4>
              <div class="quantite-container">
                <button type="button" class="moins">-</button>
                <input class="quantite" type="number" id="quantite5" name="quantite" min="0" max="10" value="0"
                  step="1">
                <button type="button" class="plus">+</button>
              </div>
            </div>
            <div class="menu-item">
              <img src="salade-sylvari.png" alt="Salade Sylvari">
              <h3>Salade Sylvari</h3>
              <p>Mélange frais aux baies</p>
              <h4>10.90€</h4>
              <div class="quantite-container">
                <button type="button" class="moins">-</button>
                <input class="quantite" type="number" id="quantite6" name="quantite" min="0" max="10" value="0"
                  step="1">
                <button type="button" class="plus">+</button>
              </div>
            </div>
            <div class="menu-item">
              <img src="beignets-koda.png" alt="Beignets de Koda">
              <h3>Beignets de Koda</h3>
              <p>Beignets au sucre glace fourrés</p>
              <h4>6.99€</h4>
              <div class="quantite-container">
                <button type="button" class="moins">-</button>
                <input class="quantite" type="number" id="quantite7" name="quantite" min="0" max="10" value="0"
                  step="1">
                <button type="button" class="plus">+</button>
              </div>
            </div>
            <div class="menu-item">
              <span class="discount">15% OFF</span>
              <img src="gateau-givre.png" alt="Gâteau Givré">
              <h3>Gâteau Givré</h3>
              <p>Cheesecake au lait nordique</p>
              <h4>8.99€</h4>
              <div class="quantite-container">
                <button type="button" class="moins">-</button>
                <input class="quantite" type="number" id="quantite8" name="quantite" min="0" max="10" value="0"
                  step="1">
                <button type="button" class="plus">+</button>
              </div>
            </div>
          </div>
          <br>
          <hr>
          <div class="panier">
            <h3>Panier de la commande</h3>
            <ul id="panier"></ul>
          </div>
          <br>
          <div class="total">
            <h3>Total</h3>
            <p> <span id="prix_total"></span> €</p>
          </div>
        </div>

      </fieldset>
      <fieldset>
        <legend>Détails de paiement</legend>
        <div class="section">
          <!-- Carte de Crédit -->
          <div class="form-group">
            <p>
              <label for="card_number">Numéro de Carte</label>
              <input type="text" id="card_number" name="card_number" placeholder="1234 5678 9012 3456">
            </p>
          </div>
        </div>

        <!-- Date d'Expiration -->
        <div class="date-code">
          <div class="form-group" id="date">
            <p>
              <label for="expiry_date">Date d'Expiration</label>
              <input type="month" id="expiry_date" name="expiry_date">
            </p>
          </div>

          <!-- Code de Sécurité (CVV) -->
          <div class="form-group" id="code">
            <p>
              <label for="cvv">Code de Sécurité (CVV)</label>
              <input type="number" id="cvv" name="cvv" placeholder="* * *">
            </p>
          </div>
        </div>
        <div class="comm">
          <label for="commentaire">Commentaire :</label>
          <textarea id="commentaire" name="commentaire" rows="4" cols="50"
            placeholder=" Avez-vous une demande particulière à nous faire ?"></textarea>
        </div>
        <br>
        <div class="confirmation">
          <input type="submit" value="Commander" aria-label="Confirmer la commande" id="commande">
        </div><br>
      </fieldset>
    </form>
  </div>

  <!-- code JavaScript :D -->
  <script type="text/javascript">
    window.addEventListener("DOMContentLoaded", function () {


      var formulaire = document.getElementById('formulaire_commande');
      document.getElementById('prix_total').textContent = '0.00';


      // fonction pour afficher un message d'erreur
      function show_erreur(elem, msg) {

        let suivant = elem.nextElementSibling;
        if (suivant && suivant.classList.contains('msg_err')) {
          suivant.remove();
        }

        const erreur = document.createElement('p');
        erreur.classList.add('msg_err');
        erreur.textContent = msg;
        elem.insertAdjacentElement('afterend', erreur);
      }

      // fonction pour vérfier la bonne mise en forme des données
      function champ_valide(champ, condition, msg_err) {
        let valeur = champ.value.replace(/\s+/g, '');
        let suivant = champ.nextElementSibling;

        if (!condition.test(valeur)) {
          show_erreur(champ, msg_err);
          champ.style.border = '3px solid #A32824';
          return false;
        } else {
          champ.style.border = '';
          if (suivant && suivant.classList.contains('msg_err')) {
            suivant.remove();
          }
          return true;
        }
      }

      // fonction pour mettre à jour le panier
      function tout_panier(nom_plat, qte_plat) {
        let articles = panier.getElementsByTagName('li');
        let article_present = false;

        for (let i = 0; i < articles.length; i++) {
          if (articles[i].dataset.nom_plat == nom_plat) {
            article_present = true;
            if (qte_plat == 0) {
              articles[i].remove();
            } else {
              articles[i].textContent = nom_plat + " - Quantité : " + qte_plat;
            }
            break;
          }
        }

        if (!article_present && qte_plat > 0) {
          let li = document.createElement('li');
          li.dataset.nom_plat = nom_plat;
          li.textContent = nom_plat + " - Quantité : " + qte_plat;
          panier.appendChild(li);
        }

        calcul_total();
      };

      // fonction pour calculer le total du panier
      function calcul_total() {
        let total = 0;
        plats.forEach(plat => {
          let prix = parseFloat(plat.querySelector('h4').textContent.replace('€', '').replace(',', '.'));
          let qte = parseInt(plat.querySelector('input[type="number"]').value);
          total += prix * qte;
        });

        document.getElementById('prix_total').innerHTML = total.toFixed(2);
      }

      // empêche l'envoi du formulaire avec la touche entrée
      formulaire.addEventListener('keydown', (e) => {
        if (e.key == 'Enter' && e.target.tagName !== 'TEXTAREA') {
          e.preventDefault();
        }
      });

      // vérifie que les formats soient conformes à ceux attendus
      var choix_livraison = document.getElementsByName('order_option');
      var data_livraison = document.querySelector('.partie2');
      var date_input = document.getElementById("date_pickup");
      var time_input = document.getElementById("time");
      var nom = document.getElementById("nom");
      var prenom = document.getElementById("prenom");
      var mel_f = document.getElementById("mail");
      var tel_f = document.getElementById("tel");
      var adresse_livraison = document.getElementById("adresse_livraison");
      var ville = document.getElementById("ville_livraison");
      var code_postal = document.getElementById("code_postal_livraison");
      var carte = document.getElementById("card_number");
      var expiration = document.getElementById("expiry_date");
      var cvv = document.getElementById("cvv");

      // indique si les champs sont mal remplis
      nom.addEventListener('input', () => {
        champ_valide(nom, /^[A-Za-zÀ-ÖØ-öø-ÿ\s\-]+$/, 'Nom invalide. Lettres uniquement.');
      });

      prenom.addEventListener('input', () => {
        champ_valide(prenom, /^[A-Za-zÀ-ÖØ-öø-ÿ\s\-]+$/, 'Prénom invalide. Lettres uniquement.');
      });

      mel_f.addEventListener('input', function () {
        champ_valide(mel_f, /^.+@.+\..+$/, 'Courriel non valide. Format attendu : exemple@mail.com');
      });

      tel_f.addEventListener('input', function () {
        if (!champ_valide(tel_f, /^0\d{9}$/, 'Numéro non valide. Format attendu : 0X XX XX XX XX')) {
          bien_rempli = false;
        }
      });

      adresse_livraison.addEventListener('input', () => {
        champ_valide(adresse_livraison, /.+/, 'Adresse requise.');
      });

      date_input.addEventListener('input', () => {
        champ_valide(date_input, /.+/, 'Date requise.');
      });

      time_input.addEventListener('input', () => {
        champ_valide(time_input, /.+/, 'Heure requise.');
      });

      ville.addEventListener('input', () => {
        champ_valide(ville, /^[A-Za-zÀ-ÖØ-öø-ÿ\s\-]+$/, 'Nom invalide. Lettres uniquement.');
      });

      code_postal.addEventListener('input', () => {
        champ_valide(code_postal, /^\d{5}$/, 'Code postal invalide. 5 chiffres attendus.');
      });

      carte.addEventListener('input', () => {
        champ_valide(carte, /^(\d{4}[- ]?){3}\d{4}$/, 'Numéro de carte invalide. Format attendu : 1234 5678 9012 3456');
      });


      expiration.addEventListener('input', () => {
        champ_valide(expiration, /.+/, "Date d'expiration requise");
      });

      cvv.addEventListener('input', () => {
        champ_valide(cvv, /^\d{3}$/, 'Code de sécurité invalide. 3 chiffres attendus.');
      });



      // Masquer ou afficher l'adresse selon le choix de mode d'achat effectué
      if (document.getElementById('pickup').checked) {
        data_livraison.style.display = 'none';
      } else {
        data_livraison.style.display = 'block';
      }

      // met à jour le document si les infos sont bonnes
      choix_livraison.forEach(choix => {
        choix.addEventListener('change', () => {
          if (document.getElementById('pickup').checked) {
            data_livraison.style.display = 'none';
          } else {
            data_livraison.style.display = 'block';
          }
        });
      });

      // gestion de la commande
      var plats = document.querySelectorAll('.menu-item')
      var panier = document.getElementById('panier')

      // ajoute des produits avec le bouton +
      plats.forEach(plat => {
        let bouton = plat.querySelector('button.plus');
        let quantity = plat.querySelector('input[type="number"]');
        let nom_plat = plat.querySelector('h3').textContent

        bouton.addEventListener('click', function () {
          let qte = parseInt(quantity.value);
          if (qte < parseInt(quantity.max) && qte < 10) {
            quantity.value = qte + 1;
            tout_panier(nom_plat, qte + 1)
          }
        });

      });

      // retire des produits avec le bouton -
      plats.forEach(plat => {
        let bouton = plat.querySelector('button.moins');
        let quantity = plat.querySelector('input[type="number"]');
        let nom_plat = plat.querySelector('h3').textContent

        bouton.addEventListener('click', function () {
          let qte = parseInt(quantity.value);
          if (qte <= parseInt(quantity.max) && qte > 0) {
            quantity.value = qte - 1;
            tout_panier(nom_plat, qte - 1)
          }
        });
      });

      // effectue les actions à l'envoi du formulaire
      formulaire.addEventListener('submit', function (event) {
        event.preventDefault();
        let bien_rempli = true

        // vérifie les champs
        if (!champ_valide(nom, /^[A-Za-zÀ-ÖØ-öø-ÿ\s\-]+$/, 'Nom invalide. Lettres uniquement.')) {
          bien_rempli = false;
        }
        if (!champ_valide(prenom, /^[A-Za-zÀ-ÖØ-öø-ÿ\s\-]+$/, 'Prénom invalide. Lettres uniquement.')) {
          bien_rempli = false;
        }
        if (!champ_valide(mel_f, /^.+@.+\..+$/, 'Courriel non valide. Format attendu : exemple@mail.com')) {
          bien_rempli = false;
        }
        if (!champ_valide(tel_f, /^0\d{9}$/, 'Numéro non valide. Format attendu : 0X XX XX XX XX')) {
          bien_rempli = false;
        }
        if (!document.getElementById('pickup').checked) {
          if (!champ_valide(adresse_livraison, /.+/, 'Adresse requise.')) {
            bien_rempli = false;
          }
          if (!champ_valide(ville, /^[A-Za-zÀ-ÖØ-öø-ÿ\s\-]+$/, 'Nom invalide. Lettres uniquement.')) {
            bien_rempli = false;
          }
          if (!champ_valide(code_postal, /^\d{5}$/, 'Code postal invalide. 5 chiffres attendus.')) {
            bien_rempli = false;
          }
        }
        if (!champ_valide(date_input, /.+/, 'Date requise.')) {
          bien_rempli = false;
        }
        if (!champ_valide(time_input, /.+/, 'Heure requise.')) {
          bien_rempli = false;
        }
        if (!champ_valide(carte, /^(\d{4}[- ]?){3}\d{4}$/, 'Numéro de carte invalide. Format attendu : 1234 5678 9012 3456')) {
          bien_rempli = false;
        }
        if (!champ_valide(expiration, /.+/, "Date d'expiration requise")) {
          bien_rempli = false;
        }
        if (!champ_valide(cvv, /^\d{3}$/, 'Code de sécurité invalide. 3 chiffres attendus.')) {
          bien_rempli = false;
        }

        // si le panier n'a aucun élément, la commande n'est pas passée
        let total_price = parseFloat(document.getElementById('prix_total').textContent);
        if (total_price <= 0) {
          alert('Merci de choisir au moins un produit.');
          bien_rempli = false;
        }

        // lorsque la commande est bien passée
        if (bien_rempli) {
          alert("Merci ! Votre commande a été envoyée avec succès.");
          formulaire.reset();
          panier.innerHTML = '';
          document.getElementById('prix_total').textContent = '0.00';
        }
      });

    });
  </script>

</body>

</html>